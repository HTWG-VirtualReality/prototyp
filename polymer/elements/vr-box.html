<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../behaviors/vr-positioner.html">
<link rel="import" href="../behaviors/vr-size.html">
<link rel="import" href="../behaviors/vr-image.html">
<link rel="import" href="../behaviors/vr-text.html">
<link rel="import" href="../behaviors/vr-highlight.html">

<script src="../bower_components/dat.gui/dat.gui.js"></script>
<script src="../js/threex.dynamic-texture.js"></script>

<script>
    window.VrElement = window.VrElement || {};
    VrElement.Box = Polymer({
        is: "vr-box",

        behaviors: [
            VrBehavior.Positioner,
            VrBehavior.Size,
            VrBehavior.Image,
            VrBehavior.Text,
            VrBehavior.Highlight
        ],

        observers: [
            'updateBox(xPos, yPos, width, height, depth, text, image)'
        ],

        updateBox: function (xPos, yPos, width, height, depth, text, image) {
            if (this.getThreeJS()) {
                this.getThreeJS().remove(this.cube);
                this.getThreeJS().remove(this.wireframe);

                this._createBox(width, height, depth, text, image);
                this.wireframe.material.color.set(0xff0000);

                this.getThreeJS().add(this.cube);
                this.getThreeJS().add(this.wireframe);
            }
        },

        ready: function () {
            var sides = 6;
            this.materials = [];

            // init all sides of cube
            var material = new THREE.MeshBasicMaterial({color: 0xffffff});
            for (var i = 0; i < sides; i++) {
                this.materials.push(material);
            }

            // creating cube and wireframe
            this._createBox(this.width, this.height, this.depth, this.text, this.image);
            this.getThreeJS().add(this.cube);
            this.getThreeJS().add(this.wireframe);
            this.addHighlight(this.wireframe.material);
        },

        _createBox: function (width, height, depth, text, image) {
            // sides of the box
            var left = 0, right = 1, bottom = 2, top = 3, front = 4, back = 5;

            this.materials[front] =  new THREE.MeshBasicMaterial();
            this.registerFrontSide(this.materials[front]);

            // create box and wireframe
            var geometry = new THREE.BoxGeometry(parseInt(width), parseInt(height), parseInt(depth));
            this.cube = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial(this.materials));
            this.wireframe = new THREE.BoxHelper(this.cube);
            this.wireframe.material.color.set(0x000000);
        }

    });
</script>