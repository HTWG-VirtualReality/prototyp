<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../behaviors/vr-three.html">
<link rel="import" href="../behaviors/vr-connection.html">
<link rel="import" href="./vr-polygon.html">
<link rel="import" href="./vr-polyline.html">

<script src="../js/general-connection.js"></script>

<dom-module id="vr-connection-inheritance">
    <template>
        <vr-polygon id="start"></vr-polygon>
        <vr-polyline id="line"></vr-polyline>
    </template>
</dom-module>

<script>
    Polymer({
        is: "vr-connection-inheritance",

        behaviors: [
            VrBehaviors.ThreeBehavior,
            VrBehaviors.ConnectionBehavior
        ],

        _render: function(points) {
            // set startpoint
            this.obj.position.setX(points.start.x);
            this.obj.position.setY(points.start.y);

            // create line
            this._createLinePoint(points.l1.x, points.l1.y);
            this._createLinePoint(points.l2.x, points.l2.y);

            // create start placing
            this._createStartPlacingPoint(10, (points.py + (10 * points.ps)) * points.pd);
            this._createStartPlacingPoint(0, points.py * points.pd);
            this._createStartPlacingPoint(-10, (points.py + (10 * points.ps)) * points.pd);

            // rotate line and start placing
            this.$.line.obj.rotation.z = points.angle || 0;
            this.$.start.obj.rotation.z = points.angle || 0;
        },

        _preResize: function() {
            // remove all children from polyline and polygon
            removeAllChildren(this.$.start);
            removeAllChildren(this.$.line);

            function removeAllChildren(parent) {

                var dom = Polymer.dom(parent);
                dom.children.forEach(function (child) {
                    dom.removeChild(child);
                });
            }
        },

        _createLinePoint: function(x, y) {
            this._createPoint(x, y, this.$.line);
        },

        _createStartPlacingPoint: function(x, y) {
            this._createPoint(x, y, this.$.start);
        },

        _createPoint: function(x, y, element) {
            var point = document.createElement('vr-point');
            point.x = x;
            point.y = y;
            Polymer.dom(element).appendChild(point);
        }

    });
</script>
