<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../behaviors/vr-three.html">
<link rel="import" href="../behaviors/vr-connection.html">
<link rel="import" href="./vr-placing.html">
<link rel="import" href="./vr-point.html">
<link rel="import" href="./vr-polygon.html">
<link rel="import" href="./vr-polyline.html">

<script src="../js/general-connection.js"></script>

<dom-module id="vr-connection-inheritance">
    <template>
        <vr-polyline id="line"></vr-polyline>
        <vr-placing offset="0.5" angle="1.5" radius="20">
            <vr-polygon>
                <vr-point x="0" y="0"></vr-point>
                <vr-point x="10" y="10"></vr-point>
                <vr-point x="-10" y="10"></vr-point>
            </vr-polygon>
        </vr-placing>
        <vr-placing offset="0" angle="0" radius="0">
            <vr-polygon>
                <vr-point x="0" y="0"></vr-point>
                <vr-point x="10" y="10"></vr-point>
                <vr-point x="-10" y="10"></vr-point>
            </vr-polygon>
        </vr-placing>
        <vr-placing offset="0.8" angle="0" radius="0">
            <vr-polygon>
                <vr-point x="0" y="0"></vr-point>
                <vr-point x="10" y="-10"></vr-point>
                <vr-point x="-10" y="-10"></vr-point>
            </vr-polygon>
        </vr-placing>
    </template>
</dom-module>

<script>
    Polymer({
        is: "vr-connection-inheritance",

        behaviors: [
            VrBehaviors.ThreeBehavior,
            VrBehaviors.ConnectionBehavior
        ],

        // _ready: function() {
        //     this.placings = [{offset: 0, angle:0, radius:0}]
        // },

        _render: function(points) {
            // set startpoint
            this.obj.position.setX(points.coord.x);
            this.obj.position.setY(points.coord.y);

            // create line
            this._createLinePoint(points.l1.x, points.l1.y);
            this._createLinePoint(points.l2.x, points.l2.y);

            Polymer.dom(this.root).children.forEach(function (node) {
                if(node.nodeName == "VR-PLACING") {
                    createPlacing(this, node);
                }
            }.bind(this));

            // createPlacing(this, this.$.placing)

            this.obj.rotation.z = points.angle || 0;

            function createPlacing(that, placing) {

                var group = new THREE.Group();
                group.position.setX(0);
                group.position.setY((points.distance*placing.offset)+points.l1.y);
                var material = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 });
                var geometry = new THREE.Geometry();
                geometry.vertices.push(new THREE.Vector3(0, 0, 0));
                geometry.vertices.push(new THREE.Vector3(0, 20, 0));
                var line = new THREE.Line(geometry, material);
                group.add(line)
                group.rotation.z = placing.angle;
                var group2 = new THREE.Group();
                group2.position.setX(0);
                group2.position.setY(20);
                // group2.add(mesh);
                // group2.rotation.z = points.angle || 0;
                group2.rotation.z = -placing.angle
                // var line2 = new THREE.Line(geometry, material);
                // group2.add(line2)

                group2.add(Polymer.dom(placing).children[0].obj)

                group.add(group2);

                that.obj.add(group)

            }
        },

        _preResize: function() {
            // remove all children from polyline and polygon
            removeAllChildren(this.$.start);
            removeAllChildren(this.$.line);

            function removeAllChildren(parent) {

                var dom = Polymer.dom(parent);
                dom.children.forEach(function (child) {
                    dom.removeChild(child);
                });
            }
        },

        _createLinePoint: function(x, y) {
            this._createPoint(x, y, this.$.line);
        },

        _createPoint: function(x, y, element) {
            var point = document.createElement('vr-point');
            point.x = x;
            point.y = y;
            Polymer.dom(element).appendChild(point);
        }

    });
</script>
