<!--
Attention: Use this behavior when you're creating a connecting. This behavior
does a lot. The new connection must have the functions:
* "_render(points)"
* "_preResize()"

The task of "_render" is to draw the connection.
The task of "preResize" is to prepare to draw a new line but you don't need to
call "_render" by yourself.

If you're confused see vr-connection-inheritance as an example for the usage
of this behavior.
-->

<script>
    window.VrBehaviors = window.VrBehaviors || {};
    VrBehaviors.ConnectionBehavior = {

        properties: {
            from: String,
            to: String
        },

        ready: function() {
            if (!this.from || !this.to) {
                console.error('properties from and to must be set');
                return;
            }

            var fromObj = document.querySelector(this.from);
            var toObj = document.querySelector(this.to);
            if (!fromObj || !toObj) {
                console.error('could not find element');
                return;
            }

            // calculate and render connection
            this._preRender();

            // add event listener for resizing
            this._registerAllListener(fromObj, toObj);

            // add Polymer children to three js group
            Polymer.dom(this.root).children.forEach(function (box) {
                this.obj.add(box.obj);
            }.bind(this));
        },

        _registerAllListener: function(fromObj, toObj) {
            this._registerListener(fromObj, toObj, 'vr-resize', this._resizeConnection);
            this._registerListener(fromObj, toObj, 'vr-delete', this._deleteConnection);
        },

        _registerListener: function(fromObj, toObj, event, func) {
            fromObj.addEventListener(event, func.bind(this));
            toObj.addEventListener(event, func.bind(this));
        },

        _resizeConnection: function () {
            this._preResize();
            this._preRender();
        },

        _preRender: function() {
            var fromObj = document.querySelector(this.from);
            var toObj = document.querySelector(this.to);
            this._render((new GeneralConnection(fromObj, toObj).render()))
        },

        _deleteConnection: function() {
            Polymer.dom(this.parentNode).removeChild(this);
        }

    };
</script>
