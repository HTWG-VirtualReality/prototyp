<link rel="import" href="vr-three.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<script>
    window.VrBehavior = window.VrBehavior || {};
    VrBehavior.Save = [VrBehavior.ThreeJS, {

        _save: function () {
            var self = this;
            var token = null;

            // get model id from href
            var href = window.location.href;
            var modelId = href.substr(href.lastIndexOf('/') + 1, href.length);

            var tagType = {
                "VR-KLASSE": "Klasse"
            };

            getToken();

            function getToken() {
                var accessTokenAttributes = {
                    method: 'POST',
                    url: 'http://localhost:9000/oauth/accessTokenLocal',
                    contentType: 'application/x-www-form-urlencoded',
                    body: 'client_id=modigen-browser-app1&grant_type=implicit',
                    id: 'token',
                    withCredentials: true,
                    success: _onTokenSuccess,
                    failure: _onFailure
                };

                self._createRequest(accessTokenAttributes);
            }

            function _onTokenSuccess(event) {
                token = event.detail.xhr.response.token_type + ' ' + event.detail.xhr.response.access_token;

                _getModel();
            }

            function _getModel() {
                var modelAttributes = {
                    id: 'model',
                    method: 'GET',
                    url: 'http://localhost:9000/models/' + modelId,
                    withCredentials: true,
                    headers: {'authorization': token},
                    success: _onModelSuccess,
                    failure: _onFailure
                };

                self._createRequest(modelAttributes);
            }

            function updateElement(old, modified) {
                if (old.mClass !== undefined) {
                    // update position
                    old.position.x = modified.xPos;
                    old.position.y = modified.yPos * -1;
                    old.size.height = modified.height;
                    old.size.width = modified.width;
                    old['init-size'].height = modified.height;
                    old['init-size'].width = modified.width;
                }
                return old;
            }

            // SORRY From ZETA!!!
            function _addModel(model, element) {
                var text = {};
                text['dominant-baseline'] = 'text-before-edge';
                text['font-family'] = 'sans-serif';
                text['font-size'] = '';
                text['fill'] = '#000000';
                text['font-weight'] = ' normal';

                var obj = {};
                obj.type = '';
                obj.size = {};
                obj.source = {};
                obj.target = {};
                obj.embeds = '';
                obj.z = Math.floor(Math.random() * (31));

                if (element.tagName === 'VR-CONNECTION-AGGREGATION') {     // conection
                    obj.type = 'zeta.MLink';
                    obj.subtype = 'aggregation';
                    obj.mReference = "Aggregation";
                    var tagFrom = document.getElementById(element.from).tagName;
                    var tagTo = document.getElementById(element.to).tagName;
                    obj.sourceAttribute = tagType[tagFrom];
                    obj.targetAttribute = tagType[tagTo];

                    obj.id = element.id;
                    obj.source.id = element.from;
                    obj.target.id = element.to;
                    obj.placings = [];
                    obj.labels = [];
                    obj.styleSet = true;
                    obj.attrs = {};
                    obj.attrs.text = text;

                    /******** CSS from ZETA - TODO generate ****************/
                    obj.attrs.fill = {};
                    obj.attrs.fill[0] = '#';
                    for (var i = 1; i <= 6; i++) {
                        obj.attrs.fill[i] = 'f';
                    }

                    obj.attrs.stroke = {};
                    obj.attrs.stroke[0] = '#';
                    for (var j = 1; j <= 6; j++) {
                        obj.attrs.stroke[j] = '0';
                    }

                    var linestyle = {};
                    linestyle['fill-opacity'] = 1;
                    linestyle['stroke'] = '#000000';
                    linestyle['stroke-width'] = 1;

                    obj.attrs['stroke-dasharray'] = {};
                    obj.attrs['stroke-dasharray'][0] = '0';
                    obj.attrs['.connection, .marker-target, .marker-source'] = linestyle;
                    obj.attrs['.connection, .marker-target, .marker-source']['stroke-dasharray'] = 0;
                    obj.attrs['.connection, .marker-target, .marker-source']['fill'] = '#fffff0';
                    obj.attrs['.connection, .marker-target, .marker-source']['dominat-baseline'] = 'text-before-edge';
                    obj.attrs['.connection, .marker-target, .marker-source']['font-family'] = 'sans-serif';
                    obj.attrs['.connection, .marker-target, .marker-source']['font-size'] = "20";
                    obj.attrs['.connection, .marker-target, .marker-source']['font-weight'] = "normal";
                    obj.attrs['.marker-target'] = linestyle;
                    obj.attrs['.marker-target']['fill'] = "#ffffff";
                    obj.attrs['.marker-target']['d'] = "M 20 10 L 40 0L 20 -10L 0 0z";
                    obj.attrs['.marker-target']['stroke-dasharray'] = 0;
                    obj.attrs['.marker-target']['text'] = text;


                } else {
                    // class
                    obj['init-size'] = {};
                    obj.resize = {};
                    obj.compartments = [];
                    obj.position = {};
                    obj.position.x = element.xPos;
                    obj.position.y = element.yPos * -1;
                    obj.angle = 0;
                    obj.nodeName = '';
                    obj.mClass = '';
                    obj.mClassAttributeInfo = [];
                    obj.id = element.id;
                    obj.resize.horizontal = true;
                    obj.resize.vertical = true;
                    obj.resize.propotional = true;
                    obj.attrs = {};


                    var ellipse = {};
                    ellipse['text'] = text;
                    ellipse['fill'] = '#ffffff';
                    ellipse['fill-opacity'] = 0.95;
                    ellipse['stroke'] = '#000000';
                    ellipse['stroke-width'] = 1;
                    ellipse['stroke-dasharray'] = '0';

                    var abstract = {};
                    abstract['text'] = text;
                    abstract['fill'] = '#ffffff';
                    abstract['fill-opacity'] = 1;
                    abstract['stroke'] = '#000000';
                    abstract['stroke-width'] = 1;
                    abstract['stroke-dasharray'] = '0';

                    var rect = {};
                    abstract['text'] = text;
                    abstract['fill'] = '#ffffff';
                    abstract['fill-opacity'] = 1;
                    abstract['stroke'] = '#000000';
                    abstract['stroke-width'] = 1;
                    abstract['stroke-dasharray'] = '0';

                    var id;
                    if (element.tagName === 'VR-PLACE') {
                        obj.type = 'zeta.place';
                        obj.initSize.width = 60;
                        obj['init-size'].height = 60;
                        obj.size.width = 60;
                        obj.size.height = 60;
                        obj.nodeName = 'placeNode';
                        obj.mClass = 'Place';
                        obj.z = 1;
                        id = 'ellipse.' + guid();
                        obj.attrs[id] = ellipse;
                        id = 'ellipse.' + guid();
                        obj.attrs[id] = ellipse;
                        var ele = {};
                        ele.id = element.id;
                        ele.mClass = 'Place';
                        ele.outputs = {};
                        ele.inputs = {};
                        ele.attributes = {};
                    } else if (element.tagName === 'VR-TRANSITION') {
                        obj.type = 'zeta.transition';
                        obj['init-size'].width = 100;
                        obj['init-size'].height = 200;
                        obj.size.width = 100;
                        obj.size.height = 200;
                        obj.nodeName = 'transitionNode';
                        obj.mClass = 'Transition';
                        obj.z = 3;
                        id = 'rect.' + guid();
                        obj.attrs[id] = ellipse;
                        id = 'rect.' + guid();
                        obj.attrs[id] = ellipse;
                    } else {
                        obj['init-size'].width = element.width;
                        obj['init-size'].height = element.height;
                        obj.size.width = element.width;
                        obj.size.height = element.height;

                        // TODO fix in zeta project
                        if (element.tagName === 'VR-KLASSE') {
                            obj.type = 'zeta.klasse';
                            obj.nodeName = 'classNode';
                            obj.mClass = 'Klasse';
                            obj.attrs['text.ab8cc40e-fba2-4df1-ab3e-667fb2fc9648'] = text;
                            obj.attrs['text.933b7f4e-e24e-48bf-86c8-da29fc0d5c26'] = text;
                            obj.attrs['text.611254ff-eb74-481f-a835-8d4979e04a80'] = text;
                            obj.attrs['rect.1699c1e7-6fac-4e36-92e6-6251ea4032a8'] = ellipse;
                            obj.attrs['rect.5ccb35e2-3ca9-4b34-aab8-cb5f87fafaae'] = ellipse;
                            obj.attrs['rect.efbae945-3ab7-4f12-af30-5f7e26554b8b'] = ellipse;
                        } else if (element.tagName === 'VR-ABSTRACTKLASSE') {
                            obj.type = 'zeta.abstractKlasse';
                            obj.nodeName = 'abClassNode';
                            obj.mClass = 'AbstractKlasse';
                            obj.attrs['rect.5fa4b7dd-401d-4607-842a-a930e6d678cb'] = abstract;
                            obj.attrs['rect.9776a8f2-83e5-4e9f-b5bc-08b12a040193'] = abstract;
                            obj.attrs['rect.f2fad98e-883b-4de5-b3d5-f66d3ffe2184'] = abstract;
                            obj.attrs['text.093d274b-9a33-4048-8a32-ee5cf5b29011'] = text;
                            obj.attrs['text.63f89879-42ed-47d1-aee2-cf3af3367bd0'] = text;
                            obj.attrs['text.b054f913-4ece-41cd-9556-f643fe04a4f9'] = text;
                        } else if (element.tagName === 'VR-INTERFACE') {
                            obj.type = 'zeta.interface';
                            obj.nodeName = 'inClassNode';
                            obj.mClass = 'InterfaceKlasse';
                            obj.attrs['rect.45717d23-213f-4758-8775-188569808a53'] = abstract;
                            obj.attrs['rect.ab4754f9-4cda-4ac3-aafe-f1763aa91bf4'] = abstract;
                            obj.attrs['rect.c81c052f-9fb0-4388-9dad-ce9ad7f047f2'] = abstract;
                            obj.attrs['text.20495d04-b291-4dd3-a96a-d933b54965bb'] = text;
                            obj.attrs['text.303b1c87-2b30-432f-a6c5-672cf785fdf8'] = text;
                            obj.attrs['text.f0c60a32-e074-43a0-942a-ab1be4fd18c2'] = text;
                        }
                    }
                }
                model.cells.push(obj);
                return model;
            }

            function guVid() {
                function s4() {
                    return Math.floor((1 + Math.random()) * 0x10000)
                            .toString(16)
                            .substring(1);
                }

                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                        s4() + '-' + s4() + s4() + s4();
            }

            function _addElemnt(allElements, element) {
                var newElement = {};
                newElement.id = element.id;
                newElement.attributes = {};

                if (element.tagName === 'VR-PLACE') {
                    newElement.mClass = 'Place';
                } else if (element.tagName === 'VR-TRANSITION') {
                    newElement.mClass = 'Transition';
                } else if (element.tagName === 'VR-KLASSE') {
                    newElement.mClass = 'Klasse'
                } else if (element.tagName === 'VR-ABSTRACTKLASSE') {
                    newElement.mClass = 'AbstractKlasse'
                } else if (element.tagName === 'VR-INTERFACE') {
                    newElement.mClass = 'InterfaceKlasse'
                }

                if (element.tagName === 'VR-CONNECTION-AGGREGATION') {
                    newElement.mReference = 'Aggregation';
                    newElement.source = {};
                    newElement.target = {};
                    var tagFrom = document.getElementById(element.from).tagName;
                    var tagTo = document.getElementById(element.to).tagName;
                    newElement.source[tagType[tagFrom]] = [];
                    newElement.source[tagType[tagFrom]][0] = element.from;
                    newElement.target[tagType[tagTo]] = [];
                    newElement.target[tagType[tagTo]] [0] = element.to;
                } else {
                    newElement.inputs = {};
                    newElement.outputs = {};
                }


                allElements.elements.push(newElement);
                return allElements;

            }

            function _onModelSuccess(event) {
                var response = event.detail.xhr.response;
                var model = JSON.parse(response.model.uiState);
                var elements = response.model;
                var children = document.querySelector('vr-scene').children;

                var currentElements = [];

                for (var i = 0; i < children.length; i++) {
                    if (children[i].tagName.indexOf("VR-") !== -1) {
                        var index = findIndexOfElement(model.cells, children[i].id);
                        currentElements.push(children[i].id);
                        if (index !== -1) {
                            model.cells[index] = updateElement(model.cells[index], children[i]);
                        } else {
                            model = _addModel(model, children[i]);
                            elements = _addElemnt(elements, children[i]);
                        }
                    }
                }

                // check if element from database is deleted
                for (var j = 0; j < model.cells.length; j++) {
                    if (currentElements.indexOf(model.cells[j].id) === -1) {
                        model.cells.splice(j, 1);
                    }
                }

                console.log(elements);


                for (var u = 0; u < elements.elements.length; u++) {
                    if (elements.elements[u].mReference !== undefined) {
                        var lineId = elements.elements[u].id;
                        var klassenId = elements.elements[u].source[Object.keys(elements.elements[u].source)[0]][0];
                        for (var v = 0; v < elements.elements.length; v++) {
                            if (elements.elements[v].id === klassenId) {
                                elements.elements[v].outputs[elements.elements[u].mReference] = [];
                                elements.elements[v].outputs[elements.elements[u].mReference][0] = lineId;
                            }
                        }
                    }
                }
                for (var u = 0; u < elements.elements.length; u++) {
                    if (elements.elements[u].mReference !== undefined) {
                        var lineId = elements.elements[u].id;
                        var klassenId = elements.elements[u].target[Object.keys(elements.elements[u].target)[0]][0];
                        for (var v = 0; v < elements.elements.length; v++) {
                            if (elements.elements[v].id === klassenId) {
                                elements.elements[v].inputs[elements.elements[u].mReference] = [];
                                elements.elements[v].inputs[elements.elements[u].mReference][0] = lineId;
                            }
                        }
                    }
                }


                // back to string
                elements.uiState = JSON.stringify(model);
                var myResponse = JSON.stringify(elements);


                var updateModelAttributes = {
                    method: 'PUT',
                    url: 'http://localhost:9000/models/' + modelId + '/definition',
                    contentType: 'application/json', // charset=UTF-8
                    body: myResponse,
                    id: 'update',
                    headers: {'authorization': token},
                    withCredentials: true,
                    success: _onSaveSuccess,
                    failure: _onFailure
                };

                self._createRequest(updateModelAttributes);

            }

            function findIndexOfElement(allElements, elementId) {
                return allElements.map(function (e) {
                    return e.id;
                }).indexOf(elementId);

            }

            function _onSaveSuccess(event) {
                alert("Success, model saved!!");
            }

            function _onFailure(error) {
                console.error(error);
            }
        }

    }];
</script>



{"name":"asasas","elements":[{"id":"8d8f8dd0-bd0d-dcf6-30f2-1f4c4e736e65","mClass":"Klasse","outputs":{},"inputs":{"Aggregation":["eb21fa87-8254-4264-9cc2-8659a47d2f3e"]},"attributes":{}},{"id":"eb6afb92-76ff-c00c-72e8-5dda2ceccd38","mClass":"Klasse","outputs":{"Aggregation":["eb21fa87-8254-4264-9cc2-8659a47d2f3e"]},"inputs":{},"attributes":{}},{"id":"eb21fa87-8254-4264-9cc2-8659a47d2f3e","mReference":"Aggregation","source":{"Klasse":["eb6afb92-76ff-c00c-72e8-5dda2ceccd38"]},"target":{"Klasse":["8d8f8dd0-bd0d-dcf6-30f2-1f4c4e736e65"]},"attributes":{}},{"id":"aaea2bf4-0a8d-c923-1469-c3db9e9ef597","attributes":{},"mClass":"Klasse","inputs":{},"outputs":{"Aggregation":["175dbf9c-f57c-b926-4c42-adc0a5bd4b09"]}},{"id":"e7c455fb-fbcc-b9f3-7e10-183661cc4bd1","attributes":{},"mClass":"Klasse","inputs":{"Aggregation":["175dbf9c-f57c-b926-4c42-adc0a5bd4b09"]},"outputs":{}},{"id":"175dbf9c-f57c-b926-4c42-adc0a5bd4b09","attributes":{},"mReference":"Aggregation","source":{"Klasse":["aaea2bf4-0a8d-c923-1469-c3db9e9ef597"]},"target":{"Klasse":["e7c455fb-fbcc-b9f3-7e10-183661cc4bd1"]}}],"uiState":"{"cells":[{"type":"zeta.klasse","init-size":{"width":100,"height":100},"size":{"width":100,"height":100},"resize":{"horizontal":true,"vertical":true,"proportional":true,"propotional":true},"compartments":[],"position":{"x":286,"y":170},"angle":0,"source":{},"target":{},"embeds":"","z":16,"nodeName":"classNode","mClass":"Klasse","mClassAttributeInfo":[],"id":"8d8f8dd0-bd0d-dcf6-30f2-1f4c4e736e65","attrs":{"text.611254ff-eb74-481f-a835-8d4979e04a80":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"text.933b7f4e-e24e-48bf-86c8-da29fc0d5c26":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"text.ab8cc40e-fba2-4df1-ab3e-667fb2fc9648":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"rect.1699c1e7-6fac-4e36-92e6-6251ea4032a8":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"},"rect.5ccb35e2-3ca9-4b34-aab8-cb5f87fafaae":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"},"rect.efbae945-3ab7-4f12-af30-5f7e26554b8b":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"}}},{"type":"zeta.klasse","init-size":{"width":100,"height":100},"size":{"width":100,"height":100},"resize":{"horizontal":true,"vertical":true,"proportional":true,"propotional":true},"compartments":[],"position":{"x":80,"y":160},"angle":0,"source":{},"target":{},"embeds":"","z":24,"nodeName":"classNode","mClass":"Klasse","mClassAttributeInfo":[],"id":"eb6afb92-76ff-c00c-72e8-5dda2ceccd38","attrs":{".1699c1e7-6fac-4e36-92e6-6251ea4032a8":{"x":"0","y":"150","width":"200","height":"185"},"text.611254ff-eb74-481f-a835-8d4979e04a80":{"x":"0","y":"150","dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},".efbae945-3ab7-4f12-af30-5f7e26554b8b":{"x":"0","y":"50","width":"200","height":"100"},"text.933b7f4e-e24e-48bf-86c8-da29fc0d5c26":{"x":"0","y":"50","dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},".5ccb35e2-3ca9-4b34-aab8-cb5f87fafaae":{"x":"0","y":"0","width":"200","height":"50"},"text.ab8cc40e-fba2-4df1-ab3e-667fb2fc9648":{"x":"0","y":"0","dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"rect.1699c1e7-6fac-4e36-92e6-6251ea4032a8":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":"1","stroke":"#000000","stroke-width":"1","stroke-dasharray":"0"},"rect.5ccb35e2-3ca9-4b34-aab8-cb5f87fafaae":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":"1","stroke":"#000000","stroke-width":"1","stroke-dasharray":"0"},"rect.efbae945-3ab7-4f12-af30-5f7e26554b8b":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":"1","stroke":"#000000","stroke-width":"1","stroke-dasharray":"0"},".611254ff-eb74-481f-a835-8d4979e04a80":{"font-size":"43","font-family":"Arial","font-weight":"400","fill":"#000000"},".933b7f4e-e24e-48bf-86c8-da29fc0d5c26":{"font-size":"43","font-family":"Arial","font-weight":"400","fill":"#000000"},".ab8cc40e-fba2-4df1-ab3e-667fb2fc9648":{"font-size":"43","font-family":"Arial","font-weight":"400","fill":"#000000"}}},{"type":"zeta.MLink","source":{"id":"eb6afb92-76ff-c00c-72e8-5dda2ceccd38"},"target":{"id":"8d8f8dd0-bd0d-dcf6-30f2-1f4c4e736e65"},"id":"eb21fa87-8254-4264-9cc2-8659a47d2f3e","embeds":"","z":26,"size":{},"subtype":"aggregation","placings":[],"sourceAttribute":"Klasse","targetAttribute":"Klasse","mReference":"Aggregation","labels":[],"styleSet":true,"attrs":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"20","fill":"#000000","font-weight":" normal"},"fill":{"0":"#","1":"f","2":"f","3":"f","4":"f","5":"f","6":"f"},"stroke":{"0":"#","1":"0","2":"0","3":"0","4":"0","5":"0","6":"0"},"stroke-dasharray":{"0":"0"},".connection, .marker-target, .marker-source":{"fill":"#000000","fill-opacity":1,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0","dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"20","font-weight":" normal"},".marker-target":{"d":"M 20 10 L 40 0L 20 -10L 0 0z","fill":"#ffffff","fill-opacity":1,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0","text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"20","fill":"#000000","font-weight":" normal"}}}},{"type":"zeta.klasse","size":{"width":100,"height":100},"source":{},"target":{},"embeds":"","z":30,"init-size":{"width":100,"height":100},"resize":{"horizontal":true,"vertical":true,"propotional":true},"compartments":[],"position":{"x":-2,"y":-42},"angle":0,"nodeName":"classNode","mClass":"Klasse","mClassAttributeInfo":[],"id":"aaea2bf4-0a8d-c923-1469-c3db9e9ef597","attrs":{"text.ab8cc40e-fba2-4df1-ab3e-667fb2fc9648":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"text.933b7f4e-e24e-48bf-86c8-da29fc0d5c26":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"text.611254ff-eb74-481f-a835-8d4979e04a80":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"rect.1699c1e7-6fac-4e36-92e6-6251ea4032a8":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"},"rect.5ccb35e2-3ca9-4b34-aab8-cb5f87fafaae":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"},"rect.efbae945-3ab7-4f12-af30-5f7e26554b8b":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"}}},{"type":"zeta.klasse","size":{"width":100,"height":100},"source":{},"target":{},"embeds":"","z":8,"init-size":{"width":100,"height":100},"resize":{"horizontal":true,"vertical":true,"propotional":true},"compartments":[],"position":{"x":205,"y":-35},"angle":0,"nodeName":"classNode","mClass":"Klasse","mClassAttributeInfo":[],"id":"e7c455fb-fbcc-b9f3-7e10-183661cc4bd1","attrs":{"text.ab8cc40e-fba2-4df1-ab3e-667fb2fc9648":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"text.933b7f4e-e24e-48bf-86c8-da29fc0d5c26":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"text.611254ff-eb74-481f-a835-8d4979e04a80":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"rect.1699c1e7-6fac-4e36-92e6-6251ea4032a8":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"},"rect.5ccb35e2-3ca9-4b34-aab8-cb5f87fafaae":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"},"rect.efbae945-3ab7-4f12-af30-5f7e26554b8b":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":"#ffffff","fill-opacity":0.95,"stroke":"#000000","stroke-width":1,"stroke-dasharray":"0"}}},{"type":"zeta.MLink","size":{},"source":{"id":"aaea2bf4-0a8d-c923-1469-c3db9e9ef597"},"target":{"id":"e7c455fb-fbcc-b9f3-7e10-183661cc4bd1"},"embeds":"","z":26,"subtype":"aggregation","mReference":"Aggregation","sourceAttribute":"Klasse","targetAttribute":"Klasse","id":"175dbf9c-f57c-b926-4c42-adc0a5bd4b09","placings":[],"labels":[],"styleSet":true,"attrs":{"text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"},"fill":{"0":"#","1":"f","2":"f","3":"f","4":"f","5":"f","6":"f"},"stroke":{"0":"#","1":"0","2":"0","3":"0","4":"0","5":"0","6":"0"},"stroke-dasharray":{"0":"0"},".connection, .marker-target, .marker-source":{"fill-opacity":1,"stroke":"#000000","stroke-width":1,"stroke-dasharray":0,"fill":"#ffffff","dominat-baseline":"text-before-edge","font-family":"sans-serif","font-size":"20","font-weight":"normal","d":"M 20 10 L 40 0L 20 -10L 0 0z","text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"}},".marker-target":{"fill-opacity":1,"stroke":"#000000","stroke-width":1,"stroke-dasharray":0,"fill":"#ffffff","dominat-baseline":"text-before-edge","font-family":"sans-serif","font-size":"20","font-weight":"normal","d":"M 20 10 L 40 0L 20 -10L 0 0z","text":{"dominant-baseline":"text-before-edge","font-family":"sans-serif","font-size":"","fill":"#000000","font-weight":" normal"}}}}]}"}